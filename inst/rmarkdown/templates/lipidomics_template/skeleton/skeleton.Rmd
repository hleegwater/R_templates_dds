---
title: ""
author: "Hanneke Leegwater"
date: "`r Sys.Date()`"
output:   
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    df_print: paged
knit: (function(inputFile, encoding) { rmarkdown::render(inputFile, encoding = encoding, output_file = stringr::str_replace(inputFile, ".Rmd",paste0("_", stringr::str_remove_all(Sys.Date(),"-"),'.html'))) })
---

# Aim

# Background and data sources

## Background

## Data sources

# Analysis

## 0. Preparations

### Load R libraries

```{r}
library(tidyverse)
library(mixOmics)
library(pheatmap)
library(cowplot)
source("../functions/transpose_tibble.R")
```

### Set input and output directories

Set base path to the project that is used in the analysis.

```{r}
base_path = str_glue("C:/Users/{Sys.getenv('USERNAME')}/surfdrive/Projects/Lipidomics")
str_glue("Base path is {base_path}")
stopifnot(dir.exists(base_path))
```

Set input data directory.

```{r}
data_path <- file.path(base_path, "Data", "Lipidomics")
str_glue("Using data from {data_path}")
stopifnot(dir.exists(data_path))
```

Set output data directory and create if it does not exist.

```{r}
datestamp <- str_remove_all(Sys.Date(), "-")
output_dir <- file.path(base_path, "Results", str_glue("{datestamp}_output"))
str_glue("Output directory path is {output_dir}")
stopifnot(dir.exists(output_dir))
```

### Define functions

## 1. Load data

Metadata for the 2DG treatment study:

```{r}
input_file <- file.path(data_path, "metadata", "metadata_all.csv")
metadata_2DG <- read_csv(input_file) %>%
  filter(Study == "treatment_2DG") %>%
  filter(cell_line != "media_only") %>%
  unite("Treatment_group", Treatment, Time, sep = "_", remove = FALSE) %>%
  unite("sampleName", cell_line, Time, biological_replicate, sep = "_", remove = FALSE) 
  
head(metadata_2DG)
```

Data from the 2DG treatment

```{r}
input_file_POS <- file.path(data_path, "data_normalized",  "treatment_2DG", "treatment_2DG_POS_PQNNormalized_cuberootTransformed_paretoScaled.csv")
input_file_NEG <- file.path(data_path, "data_normalized",  "treatment_2DG", "treatment_2DG_NEG_PQNNormalized_cuberootTransformed_paretoScaled.csv")
input_file_TG <- file.path(data_path, "data_normalized",  "treatment_2DG", "treatment_2DG_TG_PQNNormalized_cuberootTransformed_paretoScaled.csv")

data_treatment_2DG_list <- list(
  "POS" = read_csv(input_file_POS) %>% column_to_rownames("Original_name"),
  "NEG" = read_csv(input_file_NEG) %>% column_to_rownames("Original_name"),
  "TG" = read_csv(input_file_TG) %>% column_to_rownames("Original_name"))
data_treatment_2DG_list$POS[1:5,1:5]
```

Metadata for the cell line panel:

```{r}
input_file <- file.path(data_path, "metadata", "metadata_all.csv")
metadata_cell_lines <- read_csv(input_file) %>%
  filter(Study == "Cell_line_panel") %>%
  filter(cell_line != "media_only")
  
head(metadata_cell_lines)
```

Data from the cell line panel

```{r}
input_file_POS <- file.path(data_path, "data_normalized",  "cell_lines", "cell_lines_POS_PQNNormalized_cuberootTransformed_paretoScaled.csv")
input_file_NEG <- file.path(data_path, "data_normalized",  "cell_lines", "cell_lines_NEG_PQNNormalized_cuberootTransformed_paretoScaled.csv")
input_file_TG <- file.path(data_path, "data_normalized",  "cell_lines", "cell_lines_TG_PQNNormalized_cuberootTransformed_paretoScaled.csv")

data_cell_lines_list <- list(
  "POS" = read_csv(input_file_POS) %>% column_to_rownames("Original_name"),
  "NEG" = read_csv(input_file_NEG) %>% column_to_rownames("Original_name"),
  "TG" = read_csv(input_file_TG) %>% column_to_rownames("Original_name"))
data_cell_lines_list$POS[1:5,1:5]
```

### Information on lipid classes

```{r}
lipid_info <- read_csv(file.path(base_path, "Data", "Metadata", "annotated_lipid_dictionary_info.csv"))
head(lipid_info)
```

# Conclusion

## Doubts and limitations
